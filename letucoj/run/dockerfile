FROM debian:bookworm-slim

# 仅使用 bookworm 官方源，不再引入 sid
RUN apt-get update && apt-get install -y --no-install-recommends \
        openjdk-17-jre-headless \
        gcc-12 \
        libc6-dev \
        make \
    && rm -rf /var/lib/apt/lists/*

# 把 gcc-12 设为默认 gcc（可选，若容器内需要直接调用 gcc）
RUN ln -sf /usr/bin/gcc-12 /usr/bin/gcc

# 验证版本
RUN gcc --version && ls -l /usr/bin/gcc*

WORKDIR /app
RUN mkdir -p /app/localRun

# 假设 run.jar 与 Dockerfile 同目录
COPY run.jar /app/
RUN chmod +x /app/run.jar

ENV JAVA_OPTS="-Xms256m -Xmx512m -XX:+UseContainerSupport"
EXPOSE 1001
CMD ["sh", "-c", "exec java $JAVA_OPTS -jar /app/run.jar"]
